import * as PIXI from 'pixi.js'

const makeFrag = (glsl: string): string => {
  return `
    varying vec2 vTextureCoord;
    varying vec2 vFilterCoord;
    uniform sampler2D to;
    uniform vec4 filterArea;
    uniform float time, width, height;

    vec2 mapCoord( vec2 coord )
    {
        coord *= filterArea.xy;
        coord += filterArea.zw;

        return coord;
    }

    vec2 unmapCoord( vec2 coord )
    {
        coord -= filterArea.zw;
        coord /= filterArea.xy;

        return coord;
    }


    ${glsl}
    void main(){
      gl_FragColor=transition(vTextureCoord);
    }
  `
}

export default function createFilter(glsl: string) {
  return new PIXI.Filter(
    undefined,
    makeFrag(glsl),
    {
      time: {
        type: 'float',
        value: 0,
      },
      width: {
        type: 'float',
        value: 0,
      },
      height: {
        type: 'float',
        value: 0,
      },
    }
  )
}
