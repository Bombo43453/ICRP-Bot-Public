interface TickerConfig {
  FPS?: number
}

export default class Ticker {
  private _rafId?: number

  private _lastDate = 0

  constructor(
    private callback: (date: number, delta: number) => void,
    private config?: TickerConfig
  ) {}

  private _update = () => {
    const now = Date.now()
    const delta = now - this._lastDate
    const FPS = this.config && this.config.FPS || 60

    this._rafId = requestAnimationFrame(this._update)

    if (delta > 1000 / FPS) {
      this.callback(now, now - this._lastDate)
      this._lastDate = now
    }
  }

  start() {
    this._lastDate = Date.now()
    this._update()
  }

  stop() {
    cancelAnimationFrame(this._rafId!)
  }
}
